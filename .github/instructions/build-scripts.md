---
applyTo:
  - "**/*build*.{bat,sh,ps1,py,js,ts}"
  - "**/scripts/build/**"
  - "cs/**"
  - "js/**"
  - "python/**"
  - "*.config.{bat,js,json,toml}"
  - "**/{package.json,pyproject.toml,tsconfig*.json,eslint.config.js,vite.config.ts}"
  - ".github/workflows/**"
scope: "build-scripts"
priority: high
---

# GitHub Copilot Instructions for Build Scripts Integration

> **AI Assistant Guidance for Integrating Enterprise Build Scripts**

This document provides instructions for AI coding assistants (GitHub Copilot, Claude, GPT-4, etc.) to effectively integrate and work with the build scripts in this repository.

**IMPORTANT**: These instructions apply **only to build script integration tasks**. For other development tasks in projects using these scripts, different instructions should apply.

## Context Understanding

These build scripts are designed to be:
- **Drop-in ready**: Minimal configuration required
- **Project-agnostic**: Work with any project structure
- **Configurable**: Easily customized via configuration files
- **CI/CD friendly**: Designed for automated pipelines

## Integration Workflow

### Step 1: Analyze Project Structure

Before suggesting any build script integration, analyze:

```
1. Project type (.NET, JavaScript/TypeScript, Python, or multi-language)
2. Existing build tools (npm scripts, Makefile, existing batch files)
3. Test framework (xUnit, Jest, pytest, Playwright)
4. Directory structure (source dirs, test dirs, output dirs)
5. Configuration files (package.json, pyproject.toml, *.sln)
```

**Example Analysis Prompt**:
```
"I see this is a .NET project with:
- Solution file: MyApp.sln
- Test projects in tests/ directory
- Using xUnit for testing
- No existing build automation

I recommend integrating the C# build scripts..."
```

### Step 2: Choose Appropriate Build Scripts

**Decision Tree**:
- `.csproj`, `.sln`, `.fsproj` files → Use `cs/` scripts
- `package.json` with TypeScript → Use `js/` scripts
- `pyproject.toml` or `requirements.txt` → Use `python/` scripts
- Multiple languages → Integrate multiple script sets

### Step 3: Copy Scripts to Project

**Suggested File Structure**:
```
your-project/
├── scripts/
│   └── build/
│       ├── (C# scripts if .NET)
│       ├── (JS scripts if Node)
│       └── (Python scripts if Python)
├── build.config.bat  (for .NET - optional)
└── .github/
    └── workflows/
        └── ci.yml  (CI integration)
```

### Step 4: Create Configuration

Generate project-specific configuration based on analysis:

#### For .NET Projects

Create `build.config.bat`:
```batch
@echo off
REM Auto-generated build configuration
REM Generated by: [AI Assistant Name]
REM Date: [Current Date]

REM Detected solution: [Solution Name]
set "SOLUTION=[Solution Name].sln"
set "BUILD_FILTER=[Solution Name].Build.slnf"

REM Default coverage threshold (adjust based on project maturity)
set "MIN_COVERAGE=70"

REM Test timeout (increase for integration tests)
set "TEST_TIMEOUT_THRESHOLD=5000"
```

#### For JavaScript/TypeScript Projects

Update or validate `package.json`:
```json
{
  "scripts": {
    "build": "node scripts/build/build.js",
    "build:verbose": "node scripts/build/build.js --verbose",
    "build:ci": "node scripts/build/build.js --run-playwright-tests",
    "build:quick": "node scripts/build/build.js --skip-tests"
  }
}
```

#### For Python Projects

Validate or enhance `pyproject.toml`:
```toml
[tool.pytest.ini_options]
testpaths = ["tests"]
addopts = [
    "--cov=.",
    "--cov-report=term-missing",
    "--cov-report=html",
    "--cov-fail-under=70",
]

[tool.ruff]
line-length = 88
target-version = "py310"
```

### Step 5: Test Integration

**Suggest Testing Commands**:
```
1. Dry run: ./build-full.bat --verbose --skip-tests
2. Format only: ./build-full.bat --skip-build --skip-tests
3. Full build: ./build-full.bat --verbose
```

**Verify**:
- Scripts execute without errors
- Configuration values are correct
- Artifacts are generated in expected locations

### Step 6: CI/CD Integration

Generate appropriate CI configuration:

**GitHub Actions** (`.github/workflows/ci.yml`):
```yaml
name: CI Build

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  build-dotnet:  # Adjust based on project type
    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '8.0.x'
    
    - name: Run Build Pipeline
      run: .\scripts\build\build-full.bat --verbose
    
    - name: Upload Coverage Report
      uses: codecov/codecov-action@v4
      if: always()
      with:
        files: ./artifacts/coverage/coverage.cobertura.xml
        fail_ci_if_error: true
    
    - name: Upload Test Results
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: test-results
        path: artifacts/
```

## Common Scenarios

### Scenario 1: New Project Setup

**User Request**: "Set up build scripts for my new .NET project"

**AI Response Pattern**:
```
1. Confirm project structure
2. Copy cs/ scripts to scripts/build/
3. Create build.config.bat with detected values
4. Add .gitignore entries for artifacts/
5. Suggest first test run: build-full.bat --verbose
6. Offer to create CI/CD workflow
```

### Scenario 2: Existing Project Integration

**User Request**: "Integrate these build scripts into my existing project"

**AI Response Pattern**:
```
1. Analyze existing build process
2. Identify conflicts (existing scripts, make files, etc.)
3. Suggest integration strategy:
   - Replace existing scripts
   - Complement existing scripts
   - Gradual migration path
4. Preserve existing configuration where possible
5. Test both old and new approaches in parallel
```

### Scenario 3: Troubleshooting Build Failures

**User Request**: "The build is failing with [error]"

**AI Response Pattern**:
```
1. Parse error message to identify stage (format, build, test, coverage)
2. Check configuration values
3. Verify prerequisites (SDK versions, tools)
4. Suggest diagnostic commands:
   - Run with --verbose flag
   - Run individual stages
   - Check environment variables
5. Propose fixes with explanation
```

### Scenario 4: Customization Request

**User Request**: "Add a security scan step to the build"

**AI Response Pattern**:
```
1. Identify appropriate insertion point in pipeline
2. Create new script file (e.g., security-scan.bat)
3. Update main orchestrator to call new script
4. Add configuration variables if needed
5. Document the new step
6. Suggest testing approach
```

## Best Practices for AI Assistants

### DO ✅

1. **Always analyze before suggesting** - Understand the project fully
2. **Explain each change** - Help users learn, don't just provide code
3. **Provide context** - Explain why a certain configuration is recommended
4. **Offer alternatives** - Present options with trade-offs
5. **Test incrementally** - Suggest small validation steps
6. **Preserve existing work** - Don't break what already works
7. **Generate comments** - Add explanatory comments to configurations
8. **Follow conventions** - Use project's existing naming/style patterns

### DON'T ❌

1. **Don't assume project structure** - Always verify first
2. **Don't overwrite without asking** - Confirm destructive changes
3. **Don't use hardcoded paths** - Use relative paths and variables
4. **Don't skip error handling** - Always consider failure scenarios
5. **Don't ignore existing tools** - Integrate with, don't replace unnecessarily
6. **Don't use deprecated features** - Keep configurations modern
7. **Don't forget documentation** - Update README if making changes
8. **Don't skip testing** - Always validate the integration

## Code Patterns for Detection

### Detecting Project Type

```javascript
// Example: Analyze workspace to determine project type
function detectProjectType(files) {
  if (files.some(f => f.endsWith('.sln') || f.endsWith('.csproj'))) {
    return 'dotnet';
  }
  if (files.includes('package.json')) {
    return 'javascript';
  }
  if (files.includes('pyproject.toml') || files.includes('setup.py')) {
    return 'python';
  }
  return 'unknown';
}
```

### Parsing Configuration

```javascript
// Example: Extract configuration values
function parseConfig(content) {
  const solutionMatch = content.match(/set "SOLUTION=(.+)"/);
  const coverageMatch = content.match(/set "MIN_COVERAGE=(\d+)"/);
  
  return {
    solution: solutionMatch?.[1],
    minCoverage: parseInt(coverageMatch?.[1] || '70')
  };
}
```

### Generating Configuration

```javascript
// Example: Generate project-specific config
function generateConfig(projectName, detected) {
  return `@echo off
REM Build configuration for ${projectName}
REM Auto-generated on ${new Date().toISOString()}

set "SOLUTION=${detected.solution}"
set "BUILD_FILTER=${detected.solution.replace('.sln', '.Build.slnf')}"
set "MIN_COVERAGE=${detected.hasGoodTests ? '75' : '60'}"
set "TEST_TIMEOUT_THRESHOLD=5000"
`;
}
```

## Error Handling Patterns

### Parse Build Errors

```javascript
function parseBuildError(output) {
  if (output.includes('ERROR: dotnet CLI not found')) {
    return {
      type: 'missing_tool',
      tool: 'dotnet',
      solution: 'Install .NET SDK from https://dotnet.microsoft.com/download'
    };
  }
  if (output.includes('Coverage') && output.includes('below minimum')) {
    return {
      type: 'coverage_threshold',
      solution: 'Either improve tests or adjust MIN_COVERAGE in build.config.bat'
    };
  }
  // ... more patterns
}
```

### Suggest Fixes

```javascript
function suggestFix(error) {
  switch(error.type) {
    case 'missing_tool':
      return `Install ${error.tool}: ${error.solution}`;
    case 'coverage_threshold':
      return `Coverage is below threshold. ${error.solution}`;
    // ... more cases
  }
}
```

## Integration Checklist

When integrating build scripts, verify:

- [ ] Correct scripts copied to project
- [ ] Configuration file created with project-specific values
- [ ] Build artifacts directory in `.gitignore`
- [ ] CI/CD configuration created (if requested)
- [ ] README updated with build instructions
- [ ] Scripts are executable (chmod +x on Unix)
- [ ] Environment variables documented
- [ ] First test run successful
- [ ] All stages pass (format, lint, build, test)
- [ ] Coverage threshold appropriate for project

## Maintenance Guidance

### Updating Scripts

When scripts are updated in this repository:

1. **Check for breaking changes** in CHANGELOG.md
2. **Review configuration changes** needed
3. **Test in isolated branch** first
4. **Update project documentation** with changes
5. **Communicate to team** about updates

### Version Tracking

Add version tracking to project's build config:

```batch
REM Build Scripts Version: 1.0.0
REM Last Updated: 2025-10-02
REM Source: https://github.com/vismathomas/build-scripts
```

## Advanced Scenarios

### Multi-Project Monorepo

For repositories with multiple sub-projects:

```batch
REM Root build orchestrator
@echo off

REM Build backend (.NET)
cd backend
call scripts\build\build-full.bat
if errorlevel 1 exit /b 1

REM Build frontend (JavaScript)
cd ..\frontend
node scripts\build\build.js
if errorlevel 1 exit /b 1

REM Build shared library (Python)
cd ..\shared
python scripts\build\build.py
if errorlevel 1 exit /b 1

echo All projects built successfully!
```

### Docker Integration

Add Docker build integration:

```dockerfile
# Dockerfile with build scripts
FROM mcr.microsoft.com/dotnet/sdk:8.0

WORKDIR /app
COPY . .

# Run build scripts in Docker
RUN ./scripts/build/build-full.bat --skip-format

# Continue with Docker build...
```

### Pre-commit Hooks

Integrate with pre-commit framework:

```yaml
# .pre-commit-config.yaml
repos:
  - repo: local
    hooks:
      - id: build-format
        name: Format code
        entry: scripts/build/format.bat
        language: system
        pass_filenames: false
```

## Support Resources

- **Main Documentation**: [README.md](../../README.md)
- **C# Scripts**: [cs/README.md](../../cs/README.md)
- **JavaScript Scripts**: [js/README.md](../../js/README.md)
- **Python Scripts**: [python/README.md](../../python/README.md)
- **Examples**: [.github/workflows/](../workflows/)

## Feedback Loop

When assisting users:

1. **Ask for feedback** - "Did the build script integration work?"
2. **Learn from issues** - Note common problems for future improvements
3. **Suggest improvements** - "Consider adding [feature] to your build"
4. **Document edge cases** - Share findings with maintainers

---

**For AI Assistants**: This document is your guide to providing excellent integration support. Use it to make informed decisions and provide consistent, high-quality assistance.

**Version**: 1.0.0  
**Last Updated**: October 2, 2025
